FROM node:20-alpine

WORKDIR /app

COPY package*.json ./

RUN npm install

COPY . .
RUN npx prisma generate
RUN npm run build

ARG PORT=3000
ARG CRYPT_SECRET
ARG EXPRESS_SUPABASE_KEY
ARG EXPRESS_SUPABASE_URL
ARG BUCKET_ENDPOINT
ARG DATABASE_URL
ARG DIRECT_URL
ARG URL_BACKEND
ARG URL_FRONT

ENV PORT=$PORT
ENV CRYPT_SECRET=$CRYPT_SECRET
ENV EXPRESS_SUPABASE_KEY=$EXPRESS_SUPABASE_KEY
ENV EXPRESS_SUPABASE_URL=$EXPRESS_SUPABASE_URL
ENV BUCKET_ENDPOINT=$BUCKET_ENDPOINT
ENV DATABASE_URL=$DATABASE_URL
ENV DIRECT_URL=$DIRECT_URL
ENV URL_BACKEND=$URL_BACKEND
ENV URL_FRONT=$URL_FRONT

EXPOSE $PORT


CMD ["node", "build/src/index.js"]
